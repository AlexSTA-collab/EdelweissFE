*material, name=RockDamagePlasticityNonLocal, id=urmnl, statevars=5, 
** units in N and mm
** ,  E             nu          fcu         m0            e       mg1          fcy         Ah         
   56665e+03,     0.2040,  	41.60e+03,    	11.95,  	0.51,   9.943,   	29.53e+03,  0.004467   
**   Bh          Ch          Dh      Gh      As     Bs           GSI   D 
  1e-05,     8.817,  	 1e-6,    	0,  	15,     2.0,        40,   0
** omegaMax, nonlocalRadius nonlocalweight    epsilonF   
        0.99,   0.02,             1.005,          1.e-6,      
    **0.99,   0.02,             1.005,          1.36798e-3,      

*job, name=cps4nonlocaljob, domain=2d, solver=NISTParallel

*modelGenerator, generator=planeRectQuad, name=gen
x0=0, l=0.15
y0=0, h=1.5
elType=GCPS4
nX=1
nY=10

*elSet, elSet=weak
5

*section, name=sectionAll, thickness=1.00, material=urmnl, type=plane
all
*section, name=sectionWeak, thickness=0.95, material=urmnl, type=plane
weak

*fieldOutput
name=Displacement, nSet=all, field=displacement, result=U, 
name=NonlocalDmg, nSet=all, field=nonlocal damage, result=U, 
name=Stress, elSet=all, result=stress, gaussPt=1
name=Strain, elSet=all, result=strain, gaussPt=1
name=AlphaP, elSet=all, result=sdv, gaussPt=1, f(x)='x[:,0]'
name=AlphaD, elSet=all, result=sdv, gaussPt=1, f(x)='x[:,2]'
name=Omega,  elSet=all, result=sdv, gaussPt=1, f(x)='x[:,4]'
name=Displacement_Top, nSet=gen_top, field=displacement, result=U
name=Force_Bottom, nSet=gen_bottom, field=displacement, result=P
name=meanDispLoad, nSet=gen_top, field=displacement, result=U, f(x)='mean(x[:,1])', saveHistory=True
name=sumRFNodes, nSet=gen_top, field=displacement, result=P, f(x)='sum(x[:,1])', saveHistory=True

*output, type=meshplot, jobname=cps4nonlocaljob 
figure=1, axspec=221, create=pernode, fieldoutput=displacement,  label=uy, f(x)='x[:,1]'
**figure=1, axspec=224, create=pernode, fieldoutput=nonlocaldmg, label=alphadnl
figure=1, axspec=224, create=perelement, fieldoutput=alphap, label=alphap
figure=1, axspec=223, c=red, ls=dashed, create=xydata, x=meandispload, y=sumrfnodes,
figure=1, axspec=222, create=perelement, fieldoutput=omega, label=omega
*configureplots
figure=1, axspec=223, xlabel=u (m), ylabel=rf (kn) 

*step, jobName=cps4nonlocaljob, maxInc=1e-2, minInc=1e-8, maxNumInc=10000, maxIter=20, stepLength=1
options, category=NISTSolver, numThreads=15
dirichlet, name=bottom, nSet=gen_bottom,  field=displacement, 2=0
dirichlet, name=bottomLeft, nSet=gen_leftBottom,  field=displacement, 1=0
dirichlet, name=top, nSet=gen_top, field=displacement, 2=0.0004


*parameterIdentification, id=urmnl, jobName=cps4nonlocaljob, xData=u_1el_GSI40.csv, yData=RF_1el_GSI40.csv, plot=True, file=identifiedParameters.inp
idx=19, start=0.001, min=0.000001, max=0.01   
type=x, fieldOutput=meanDispLoad
type=y, fieldOutput=sumRFNodes 
