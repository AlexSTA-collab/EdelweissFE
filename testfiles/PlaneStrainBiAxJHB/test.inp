*modelGenerator, generator=planeRectQuad, name=gen
l=30
h=30
nX=3
nY=3
elType=uelCPE4

*material, name=JointedHoekBrown, id=RockMat
**E1  |   E2  |   E3  |  nu12 | nu23 |  nu13 |  G12  |  G23  |  G13            ** G23 = 2*(1+nu23)/E2 ---> transversal isotropy
0.3e4,  1.05e4,  1.05e4, 0.25,   0.35,  0.25,  2.0e4,  2.57e4, 2.0e4,     
**Normal Vector Plane1
**nx | ny | nz
1,0.57,0,
**Hoek Brown for Intact Rock Matrix
**fcu | m0 |  e  | GSI  |  D
400.0, 10.0, 0.51, 100.0, 0.0,
**Hardening/Plasticity Plane1
**psiDeg1 | phiDeg1_yield | phiDeg1_peak | c1 | Amat1
3.26,           27.0,            27.0,    1000.0, 0.09,
**Hardening/Plasticity Plane2
**psiDeg2 | phiDeg2_yield | phiDeg2_peak | c2 | Amat2
3.26,           10,            10.0,    5.0, 0.09,
**Hardening/Plasticity Plane3
**psiDeg3 | phiDeg3_yield | phiDeg3_peak | c3 | Amat3
3.26,           5.0,            5.0,    200.0, 50,
**Damage
**As      |      GFI      |  enableDamage
15,              80,              0 

*section, name=section1, thickness=1.0, material=RockMat, type=planeUelUmat
all

*job, name=cpe4job, domain=2d, solver=NIST
*fieldOutput,
name=dispTop, nSet=gen_top,       field=displacement, result=U, f(x)='mean(x[:,1])', saveHistory=True
name=dispRight, nSet=gen_right,       field=displacement, result=U, f(x)='mean(x[:,0])', saveHistory=True
name=RFBottom, nSet=gen_bottom,    field=displacement, result=P, f(x)='sum(x[:,1])', saveHistory=True
name=RFLeft, nSet=gen_left,    field=displacement, result=P, f(x)='sum(x[:,0])', saveHistory=True
elSet=all,  field=displacement, result=U, name=displacement
elSet=all,  result=stress,  gaussPt=0:3, f(x)='np.mean(x,axis=1)', name=stress
elSet=all,  result=strain,  gaussPt=0:3, f(x)='np.mean(x,axis=1)', name=strain
name=YS_N, elSet=all, result=ys_plane_n, gaussPt=1
name=YS_X2, elSet=all, result=ys_plane_x2, gaussPt=1
name=YS_X1, elSet=all, result=ys_plane_x1, gaussPt=1
name=YS_HB, elSet=all, result=ys_HB, gaussPt=1

*output, type=monitor, jobName=cpe4job
fieldOutput=dispTop
fieldOutput=dispRight
fieldOutput=RFBottom
fieldOutput=RFLeft

*output, type=ensight, jobName=cpe4job, name=ensightExport
create=perNode, fieldOutput=displacement
create=perElement, fieldOutput=stress
create=perElement, fieldOutput=strain
configuration, overwrite=yes
create=perElement, elset=all,  fieldOutput=YS_N
create=perElement, elset=all,  fieldOutput=YS_X2
create=perElement, elset=all,  fieldOutput=YS_X1
create=perElement, elset=all,  fieldOutput=YS_HB

*output, type=meshplot, jobName=cpe4job
figure=1, axSpec=111, c=red, create=xyData, x=dispRight, y=RFLeft
figure=2, axSpec=111, c=red, create=xyData, x=dispTop, y=RFBottom

*step, jobName=cpe4job, maxInc=0.5
dirichlet, name=left,   nSet=gen_left,   field=displacement,	1=0.0 
**dirichlet, name=bottomleft, nSet=gen_bottomleft, field=displacement, 2=0.0
dirichlet, name=bottom, nSet=gen_bottom, field=displacement, 	2=0.0 
geostatic, name=geo, elSet=all, p1=-10, h1=0, p2=-10, h2=30, xLateral=1.0, zLateral=1.0
distributedload, name=dlRight, surface=gen_right, magnitude=10, f(t)=1, type=pressure
distributedload, name=dlTop, surface=gen_top, magnitude=10, f(t)=1, type=pressure

*step, jobName=cpe4job, maxInc=1e-2, 
dirichlet, name=top,  nSet=gen_top,   field=displacement, 2=-1,
**dirichlet, name=right,  nSet=gen_right,   field=displacement, 1=-1,
